<!-- <form autocomplete="off" action="/interaction/<%= uid %>/login" method="post">
  <input required type="text" name="xxx" placeholder="Enter login" <% if (!params.login_hint) { %>autofocus="on"<% } else { %> value="<%= params.login_hint %>" <% } %>>
  <input required type="password" name="yyyy" placeholder="and password" <% if (params.login_hint) { %>autofocus="on"<% } %>>

  <button type="submit" class="login login-submit">Sign-in</button>
</form> -->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@picocss/pico@1.5.6/css/pico.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <style>
      .hidden {
        display: none;
      }
    </style>
    <script>
      window.addEventListener("load", () => {
        if (!window.ethereum) {
          return;
        }

        const $ = document.querySelector.bind(document);

        window.web3 = new Web3(ethereum);

        const submitButton = $("#submit-login");
        submitButton.disabled = true;

        const onConnect = async () => {
          // Open a connect window. It resolves when the connection is accepted.
          const [ethereamAddress] = await ethereum.enable();

          $("#connected-account").textContent = `Connected: ${ethereamAddress}`;
          $("#account-visibility-toggle").className = "";

          const message = "HELLO, WORLD"; // TODO:
          const signature = await web3.eth.personal.sign(
            message,
            ethereamAddress,
            ""
          ); // 署名できる
          console.log(signature);

          $("input[name=signature]").value = signature;
          $("input[name=ethereamAddress]").value = ethereamAddress;
          // Make the rest form visible by resetting class
          $("#form-visibility-toggle").className = "";

          // Enable the submit button only when all inputs have value
          const inputs = [
            $("input[name=contractAddress]"),
            $("input[name=tokenID]"),
          ];
          inputs.forEach((input) => {
            input.addEventListener("input", () => {
              const ready = inputs.every((input) => Boolean(input.value));
              submitButton.disabled = !ready;
            });
          });
        };

        $("#connect").addEventListener("click", onConnect);
      });
    </script>
  </head>
  <body>
    <main class="container">
      <article>
        <h1>Sign in with NFT</h1>
        <section>
          <button id="connect">Connect to Metamask</button>
          <pre
            id="account-visibility-toggle"
            class="hidden"
          ><code id="connected-account"></code></pre>
        </section>

        <!-- Visible after connected -->
        <div id="form-visibility-toggle" class="hidden">
          <form
            autocomplete="off"
            action="/interaction/<%= uid %>/login"
            method="post"
          >
            <div>
              <label>
                NFT Contract Address
                <input type="text" name="contractAddress" />
              </label>
            </div>
            <div>
              <label>
                NFT Item ID
                <input type="text" name="tokenID" />
              </label>
            </div>

            <!-- Hidden forms -->
            <input type="text" name="signature" class="hidden" />
            <input type="text" name="ethereamAddress" class="hidden" />

            <!-- Submit button -->
            <button id="submit-login" type="submit">Sign in</button>
          </form>
        </div>
      </article>
    </main>
  </body>
</html>
