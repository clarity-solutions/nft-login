require("dotenv").config();

// It must be generated by generate-keys.js script
const jwks = require("./jwks.json");

module.exports = {
  clients: [
    {
      client_id: "example_client",
      client_secret: "mmake95#kDuRRRR#3rak3r1dccaMd",
      redirect_uris: [
        "https://example.localhost/callback",
        // using jwt.io as redirect_uri to show the ID Token contents
        "https://jwt.io",
      ],
      response_types: ["id_token"],
      grant_types: ["implicit"],
      token_endpoint_auth_method: "none",
    },
  ],
  interactions: {
    url(ctx, interaction) {
      return `/interaction/${interaction.uid}`;
    },
  },
  async findAccount(ctx, sub) {
    // sub is "/"-separated string
    const [nft_contract_address, nft_item_id] = sub.split("/");
    return {
      accountId: sub,
      async claims() {
        return {
          sub,
          nft_contract_address,
          nft_item_id,
        };
      },
    };
  },
  responseTypes: ["id_token"],
  cookies: {
    keys: process.env.OIDCP_SECURE_KEYS.split(","),
  },
  claims: {
    openid: ["sub", "nft_contract_address", "nft_item_id"],
  },
  features: {},
  jwks,
};
